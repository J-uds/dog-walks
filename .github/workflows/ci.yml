name: CI - Continuous Integration

# When executes?
on:
  push:
    branches: [ main, dev ]  # when upload to main or dev
  pull_request:
    branches: [ main, dev ]  # when performing pull to main

jobs:
  test:
    name: Run unit test
    runs-on: ubuntu-latest   # Virtual machine where it id executed

    steps:
    # Step 1: Download code
    - name: Checkout code
      uses: actions/checkout@v4
      
    # Step 2: Configure Java 
    - name: Configure Java 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        # cache: maven

    - name: Make Maven wrapper executable
      run: chmod +x ./mvnw

    - name: Start Docker service
      run: |
        sudo systemctl start docker
        sudo docker info 

    # Step 4: Run unit tests
    - name: Run tests
      run: ./mvn clean test -Dtest="**/*Test" -DfailIfNoTests=false
      env:
        #DB_URL_LOCAL: jdbc:mysql://localhost:3306/dogwalks_github_test?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
        #DB_ROOT_USER: github_test_user
        #DB_ROOT_PASSWORD: github_test_password
        JWT_SECRET: test-secret-key-for-github-actions
        JWT_EXPIRATION: 3600000
        ADMIN_EMAIL: admin@test.com
        ADMIN_PASSWORD: TestPassword123!